<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatGPT Chat</title>
    {% load static %}
    <link rel="stylesheet" href="{% static '../static/style.css' %}">
    <style>
        /* ì—¬ê¸°ì— ì¶”ê°€ì ì¸ CSSë¥¼ ë„£ì–´ë„ ë¨. */
    </style>
</head>
<body>
    <div class="chat-container">
        <form id="chat-form" action="chat" method="post" enctype="application/x-www-form-urlencoded">
            {% csrf_token %}
            <div id="chat-history">
                <!-- ì±„íŒ… ë‚´ìš©ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë  ë¶€ë¶„ -->
            </div>
            <div id="question-box">
                <div id="file-module-0">
                    <label for="question">ChatGPTì—ê²Œ ì§ˆë¬¸í•˜ê¸°</label>
                    <textarea id="question" name="question"></textarea>
                </div>
                <div>
                    <button id="text-button" type="submit">ì§ˆë¬¸</button>
                </div>
            </div>
        </form>
    </div>

    <!-- jQuery ì¶”ê°€ -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- JavaScript ì½”ë“œ ì¶”ê°€ -->
    <script>
        $(document).ready(function() {
            // ì´ˆê¸° ë©”ì‹œì§€ ì¶”ê°€
            addChatMessage('bot', 'ì•ˆë…•í•˜ì„¸ìš”! ğŸ«§<br>KT ì—ì´ë¸”ìŠ¤ì¿¨ì— ê´€ë ¨í•´ ì§ˆë¬¸í•´ì£¼ì„¸ìš”.');
        
            $('#chat-form').submit(function(event) {
                event.preventDefault(); // ê¸°ë³¸ ì œì¶œ ë™ì‘ ë°©ì§€
                var formData = $(this).serialize(); // í¼ ë°ì´í„° ì§ë ¬í™”
        
                // AJAX ìš”ì²­
                $.ajax({
                    type: 'POST',
                    url: $(this).attr('action'),
                    data: formData,
                    success: function(response) {
                        var question = $('#question').val(); // ì§ˆë¬¸ ë‚´ìš© ê°€ì ¸ì˜¤ê¸°
                        addChatMessage('me', question); // ì‚¬ìš©ì ì§ˆë¬¸ ì¶”ê°€
        
                        var result = response.result; // ì„œë²„ì—ì„œ ë°›ì€ ë‹µë³€
                        addChatMessage('bot', result); // ë´‡ ë‹µë³€ ì¶”ê°€
        
                        $('#question').val(''); // ì§ˆë¬¸ ì…ë ¥ì°½ ì´ˆê¸°í™”
                    },
                    error: function(xhr, errmsg, err) {
                        console.log('Error:', errmsg); // ì˜¤ë¥˜ ì²˜ë¦¬
                    }
                });
            });

        
            // ì±„íŒ…ì°½ì— ë©”ì‹œì§€ ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
            function addChatMessage(sender, message) {
                var chatHistory = $('#chat-history');
                var messageClass = (sender === 'me') ? 'message me' : 'message bot';
                
                var messageElement = $('<div class="' + messageClass + '"></div>').html(message);
                // ì²« ë©”ì‹œì§€ ì¤„ë°”ê¿ˆ ìœ„í•´ message ë³€ìˆ˜ì— HTML íƒœê·¸ë¥¼ í¬í•¨í•˜ë„ë¡ ìˆ˜ì •
                
                chatHistory.append(messageElement);
            
                // ì±„íŒ…ì°½ì„ ë§¨ ì•„ë˜ë¡œ ìŠ¤í¬ë¡¤
                chatHistory.scrollTop(chatHistory[0].scrollHeight);
            }
        });
    </script>
</body>
</html>